{"version":3,"sources":["build/buildApp.js"],"names":["copy","ncp","log","require","selectAppArgs","options","name","targetUrl","counter","bounce","width","height","minWidth","minHeight","maxWidth","maxHeight","x","y","showMenuBar","fastQuit","userAgent","nativefierVersion","ignoreCertificate","disableGpu","ignoreGpuBlacklist","enableEs3Apis","insecure","flashPluginDir","diskCacheSize","fullScreen","hideWindowFrame","maximize","disableContextMenu","disableDevTools","zoom","internalUrls","crashReporter","singleInstance","clearCache","appCopyright","appVersion","buildVersion","win32metadata","versionString","processEnvs","fileDownloadOptions","tray","basicAuthUsername","basicAuthPassword","alwaysOnTop","titleBarStyle","globalShortcuts","maybeCopyScripts","srcs","dest","Promise","resolve","promises","map","src","reject","fs","existsSync","Error","destFileName","path","extname","join","error","all","then","catch","normalizeAppName","appName","url","hash","crypto","createHash","update","postFixHash","digest","substring","normalized","_","kebabCase","toLowerCase","changeAppPackageJsonName","appPath","packageJsonPath","packageJson","JSON","parse","readFileSync","writeFileSync","stringify","buildApp","callback","appArgs","inject","err","warn"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,OAAOC,cAAIA,GAAjB;AACA,IAAMC,MAAMC,QAAQ,UAAR,CAAZ;AACA;;;;AAIA,SAASC,aAAT,CAAuBC,OAAvB,EAAgC;AAC9B,SAAO;AACLC,UAAMD,QAAQC,IADT;AAELC,eAAWF,QAAQE,SAFd;AAGLC,aAASH,QAAQG,OAHZ;AAILC,YAAQJ,QAAQI,MAJX;AAKLC,WAAOL,QAAQK,KALV;AAMLC,YAAQN,QAAQM,MANX;AAOLC,cAAUP,QAAQO,QAPb;AAQLC,eAAWR,QAAQQ,SARd;AASLC,cAAUT,QAAQS,QATb;AAULC,eAAWV,QAAQU,SAVd;AAWLC,OAAGX,QAAQW,CAXN;AAYLC,OAAGZ,QAAQY,CAZN;AAaLC,iBAAab,QAAQa,WAbhB;AAcLC,cAAUd,QAAQc,QAdb;AAeLC,eAAWf,QAAQe,SAfd;AAgBLC,uBAAmBhB,QAAQgB,iBAhBtB;AAiBLC,uBAAmBjB,QAAQiB,iBAjBtB;AAkBLC,gBAAYlB,QAAQkB,UAlBf;AAmBLC,wBAAoBnB,QAAQmB,kBAnBvB;AAoBLC,mBAAepB,QAAQoB,aApBlB;AAqBLC,cAAUrB,QAAQqB,QArBb;AAsBLC,oBAAgBtB,QAAQsB,cAtBnB;AAuBLC,mBAAevB,QAAQuB,aAvBlB;AAwBLC,gBAAYxB,QAAQwB,UAxBf;AAyBLC,qBAAiBzB,QAAQyB,eAzBpB;AA0BLC,cAAU1B,QAAQ0B,QA1Bb;AA2BLC,wBAAoB3B,QAAQ2B,kBA3BvB;AA4BLC,qBAAiB5B,QAAQ4B,eA5BpB;AA6BLC,UAAM7B,QAAQ6B,IA7BT;AA8BLC,kBAAc9B,QAAQ8B,YA9BjB;AA+BLC,mBAAe/B,QAAQ+B,aA/BlB;AAgCLC,oBAAgBhC,QAAQgC,cAhCnB;AAiCLC,gBAAYjC,QAAQiC,UAjCf;AAkCLC,kBAAclC,QAAQkC,YAlCjB;AAmCLC,gBAAYnC,QAAQmC,UAnCf;AAoCLC,kBAAcpC,QAAQoC,YApCjB;AAqCLC,mBAAerC,QAAQqC,aArClB;AAsCLC,mBAAetC,QAAQsC,aAtClB;AAuCLC,iBAAavC,QAAQuC,WAvChB;AAwCLC,yBAAqBxC,QAAQwC,mBAxCxB;AAyCLC,UAAMzC,QAAQyC,IAzCT;AA0CLC,uBAAmB1C,QAAQ0C,iBA1CtB;AA2CLC,uBAAmB3C,QAAQ2C,iBA3CtB;AA4CLC,iBAAa5C,QAAQ4C,WA5ChB;AA6CLC,mBAAe7C,QAAQ6C,aA7ClB;AA8CLC,qBAAiB9C,QAAQ8C;AA9CpB,GAAP;AAgDD;;AAED,SAASC,gBAAT,CAA0BC,IAA1B,EAAgCC,IAAhC,EAAsC;AACpC,MAAI,CAACD,IAAL,EAAW;AACT,WAAO,IAAIE,OAAJ,CAAY,UAACC,OAAD,EAAa;AAC9BA;AACD,KAFM,CAAP;AAGD;AACD,MAAMC,WAAWJ,KAAKK,GAAL,CACf,UAACC,GAAD;AAAA,WACE,IAAIJ,OAAJ,CAAY,UAACC,OAAD,EAAUI,MAAV,EAAqB;AAC/B,UAAI,CAACC,aAAGC,UAAH,CAAcH,GAAd,CAAL,EAAyB;AACvBC,eAAO,IAAIG,KAAJ,CAAU,+CAAV,CAAP;AACA;AACD;;AAED,UAAIC,qBAAJ;AACA,UAAIC,eAAKC,OAAL,CAAaP,GAAb,MAAsB,KAA1B,EAAiC;AAC/BK,uBAAe,WAAf;AACD,OAFD,MAEO,IAAIC,eAAKC,OAAL,CAAaP,GAAb,MAAsB,MAA1B,EAAkC;AACvCK,uBAAe,YAAf;AACD,OAFM,MAEA;AACLR;AACA;AACD;;AAEDxD,WAAK2D,GAAL,EAAUM,eAAKE,IAAL,CAAUb,IAAV,EAAgB,QAAhB,EAA0BU,YAA1B,CAAV,EAAmD,UAACI,KAAD,EAAW;AAC5D,YAAIA,KAAJ,EAAW;AACTR,iBAAO,IAAIG,KAAJ,CAAW,kCAAiCK,KAAM,EAAlD,CAAP;AACA;AACD;AACDZ;AACD,OAND;AAOD,KAvBD,CADF;AAAA,GADe,CAAjB;;AA4BA,SAAO,IAAID,OAAJ,CAAY,UAACC,OAAD,EAAUI,MAAV,EAAqB;AACtCL,YAAQc,GAAR,CAAYZ,QAAZ,EACGa,IADH,CACQ,YAAM;AACVd;AACD,KAHH,EAIGe,KAJH,CAIS,UAACH,KAAD,EAAW;AAChBR,aAAOQ,KAAP;AACD,KANH;AAOD,GARM,CAAP;AASD;;AAED,SAASI,gBAAT,CAA0BC,OAA1B,EAAmCC,GAAnC,EAAwC;AACtC;AACA,MAAMC,OAAOC,iBAAOC,UAAP,CAAkB,KAAlB,CAAb;AACAF,OAAKG,MAAL,CAAYJ,GAAZ;AACA,MAAMK,cAAcJ,KAAKK,MAAL,CAAY,KAAZ,EAAmBC,SAAnB,CAA6B,CAA7B,EAAgC,CAAhC,CAApB;AACA,MAAMC,aAAaC,iBAAEC,SAAF,CAAYX,QAAQY,WAAR,EAAZ,CAAnB;AACA,SAAQ,GAAEH,UAAW,eAAcH,WAAY,EAA/C;AACD;;AAED,SAASO,wBAAT,CAAkCC,OAAlC,EAA2CjF,IAA3C,EAAiDoE,GAAjD,EAAsD;AACpD,MAAMc,kBAAkBvB,eAAKE,IAAL,CAAUoB,OAAV,EAAmB,eAAnB,CAAxB;AACA,MAAME,cAAcC,KAAKC,KAAL,CAAW9B,aAAG+B,YAAH,CAAgBJ,eAAhB,CAAX,CAApB;AACAC,cAAYnF,IAAZ,GAAmBkE,iBAAiBlE,IAAjB,EAAuBoE,GAAvB,CAAnB;AACAb,eAAGgC,aAAH,CAAiBL,eAAjB,EAAkCE,KAAKI,SAAL,CAAeL,WAAf,CAAlC;AACD;;AAED;;;;;;;;;AASA,SAASM,QAAT,CAAkBpC,GAAlB,EAAuBL,IAAvB,EAA6BjD,OAA7B,EAAsC2F,QAAtC,EAAgD;AAC9C,MAAMC,UAAU7F,cAAcC,OAAd,CAAhB;AACAL,OAAK2D,GAAL,EAAUL,IAAV,EAAgB,UAACc,KAAD,EAAW;AACzB,QAAIA,KAAJ,EAAW;AACT4B,eAAU,sCAAqC5B,KAAM,EAArD;AACA;AACD;;AAEDP,iBAAGgC,aAAH,CACE5B,eAAKE,IAAL,CAAUb,IAAV,EAAgB,kBAAhB,CADF,EAEEoC,KAAKI,SAAL,CAAeG,OAAf,CAFF;;AAKA7C,qBAAiB/C,QAAQ6F,MAAzB,EAAiC5C,IAAjC,EACGiB,KADH,CACS,UAAC4B,GAAD,EAAS;AACdjG,UAAIkG,IAAJ,CAASD,GAAT;AACD,KAHH,EAIG7B,IAJH,CAIQ,YAAM;AACVgB,+BAAyBhC,IAAzB,EAA+B2C,QAAQ3F,IAAvC,EAA6C2F,QAAQ1F,SAArD;AACAyF;AACD,KAPH;AAQD,GAnBD;AAoBD;;kBAEcD,Q","file":"buildApp.js","sourcesContent":["import fs from 'fs';\nimport crypto from 'crypto';\nimport _ from 'lodash';\nimport path from 'path';\nimport ncp from 'ncp';\n\nconst copy = ncp.ncp;\nconst log = require('loglevel');\n/**\n * Only picks certain app args to pass to nativefier.json\n * @param options\n */\nfunction selectAppArgs(options) {\n  return {\n    name: options.name,\n    targetUrl: options.targetUrl,\n    counter: options.counter,\n    bounce: options.bounce,\n    width: options.width,\n    height: options.height,\n    minWidth: options.minWidth,\n    minHeight: options.minHeight,\n    maxWidth: options.maxWidth,\n    maxHeight: options.maxHeight,\n    x: options.x,\n    y: options.y,\n    showMenuBar: options.showMenuBar,\n    fastQuit: options.fastQuit,\n    userAgent: options.userAgent,\n    nativefierVersion: options.nativefierVersion,\n    ignoreCertificate: options.ignoreCertificate,\n    disableGpu: options.disableGpu,\n    ignoreGpuBlacklist: options.ignoreGpuBlacklist,\n    enableEs3Apis: options.enableEs3Apis,\n    insecure: options.insecure,\n    flashPluginDir: options.flashPluginDir,\n    diskCacheSize: options.diskCacheSize,\n    fullScreen: options.fullScreen,\n    hideWindowFrame: options.hideWindowFrame,\n    maximize: options.maximize,\n    disableContextMenu: options.disableContextMenu,\n    disableDevTools: options.disableDevTools,\n    zoom: options.zoom,\n    internalUrls: options.internalUrls,\n    crashReporter: options.crashReporter,\n    singleInstance: options.singleInstance,\n    clearCache: options.clearCache,\n    appCopyright: options.appCopyright,\n    appVersion: options.appVersion,\n    buildVersion: options.buildVersion,\n    win32metadata: options.win32metadata,\n    versionString: options.versionString,\n    processEnvs: options.processEnvs,\n    fileDownloadOptions: options.fileDownloadOptions,\n    tray: options.tray,\n    basicAuthUsername: options.basicAuthUsername,\n    basicAuthPassword: options.basicAuthPassword,\n    alwaysOnTop: options.alwaysOnTop,\n    titleBarStyle: options.titleBarStyle,\n    globalShortcuts: options.globalShortcuts,\n  };\n}\n\nfunction maybeCopyScripts(srcs, dest) {\n  if (!srcs) {\n    return new Promise((resolve) => {\n      resolve();\n    });\n  }\n  const promises = srcs.map(\n    (src) =>\n      new Promise((resolve, reject) => {\n        if (!fs.existsSync(src)) {\n          reject(new Error('Error copying injection files: file not found'));\n          return;\n        }\n\n        let destFileName;\n        if (path.extname(src) === '.js') {\n          destFileName = 'inject.js';\n        } else if (path.extname(src) === '.css') {\n          destFileName = 'inject.css';\n        } else {\n          resolve();\n          return;\n        }\n\n        copy(src, path.join(dest, 'inject', destFileName), (error) => {\n          if (error) {\n            reject(new Error(`Error Copying injection files: ${error}`));\n            return;\n          }\n          resolve();\n        });\n      }),\n  );\n\n  return new Promise((resolve, reject) => {\n    Promise.all(promises)\n      .then(() => {\n        resolve();\n      })\n      .catch((error) => {\n        reject(error);\n      });\n  });\n}\n\nfunction normalizeAppName(appName, url) {\n  // use a simple 3 byte random string to prevent collision\n  const hash = crypto.createHash('md5');\n  hash.update(url);\n  const postFixHash = hash.digest('hex').substring(0, 6);\n  const normalized = _.kebabCase(appName.toLowerCase());\n  return `${normalized}-nativefier-${postFixHash}`;\n}\n\nfunction changeAppPackageJsonName(appPath, name, url) {\n  const packageJsonPath = path.join(appPath, '/package.json');\n  const packageJson = JSON.parse(fs.readFileSync(packageJsonPath));\n  packageJson.name = normalizeAppName(name, url);\n  fs.writeFileSync(packageJsonPath, JSON.stringify(packageJson));\n}\n\n/**\n * Creates a temporary directory and copies the './app folder' inside,\n * and adds a text file with the configuration for the single page app.\n *\n * @param {string} src\n * @param {string} dest\n * @param {{}} options\n * @param callback\n */\nfunction buildApp(src, dest, options, callback) {\n  const appArgs = selectAppArgs(options);\n  copy(src, dest, (error) => {\n    if (error) {\n      callback(`Error Copying temporary directory: ${error}`);\n      return;\n    }\n\n    fs.writeFileSync(\n      path.join(dest, '/nativefier.json'),\n      JSON.stringify(appArgs),\n    );\n\n    maybeCopyScripts(options.inject, dest)\n      .catch((err) => {\n        log.warn(err);\n      })\n      .then(() => {\n        changeAppPackageJsonName(dest, appArgs.name, appArgs.targetUrl);\n        callback();\n      });\n  });\n}\n\nexport default buildApp;\n"]}